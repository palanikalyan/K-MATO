<div class="orders-page">
  <div class="container">
    <div class="page-header">
      <h1 class="page-title">My Orders</h1>
      <button class="btn btn-secondary" routerLink="/restaurants">
        <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
          <path d="M3 9h12M9 3l6 6-6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Browse Restaurants
      </button>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <button 
        class="tab" 
        [class.active]="selectedTab === 'active'"
        (click)="selectTab('active')">
        Active Orders ({{ activeOrders.length }})
      </button>
      <button 
        class="tab" 
        [class.active]="selectedTab === 'history'"
        (click)="selectTab('history')">
        Order History ({{ orderHistory.length }})
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
      <div class="spinner"></div>
      <p>Loading your orders...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-state">
      <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
        <circle cx="40" cy="40" r="35" stroke="var(--error)" stroke-width="3"/>
        <path d="M40 25v20M40 50v5" stroke="var(--error)" stroke-width="3" stroke-linecap="round"/>
      </svg>
      <h2>{{ error }}</h2>
      <button class="btn btn-primary" (click)="loadOrders()">Try Again</button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && displayedOrders.length === 0" class="empty-state">
      <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
        <circle cx="60" cy="60" r="50" fill="var(--background-light)"/>
        <path d="M40 50h40l-8 35H48l-8-35z" stroke="var(--text-light)" stroke-width="3"/>
        <circle cx="50" cy="95" r="4" fill="var(--text-light)"/>
        <circle cx="70" cy="95" r="4" fill="var(--text-light)"/>
      </svg>
      <h2 *ngIf="selectedTab === 'active'">No active orders</h2>
      <h2 *ngIf="selectedTab === 'history'">No order history</h2>
      <p>Start ordering from your favorite restaurants</p>
      <button class="btn btn-primary" routerLink="/restaurants">Browse Restaurants</button>
    </div>

    <!-- Orders List -->
    <div *ngIf="!loading && displayedOrders.length > 0" class="orders-list">
      <div class="order-card" *ngFor="let order of displayedOrders">
        <!-- Order Header -->
        <div class="order-header">
          <div class="order-info">
            <h3 class="restaurant-name" (click)="goToRestaurant(order.restaurantId)">
              {{ order.restaurantId }}
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M6 3l5 5-5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </h3>
            <p class="order-id">Order #{{ order.id }}</p>
          </div>
          <span class="badge" [ngClass]="getStatusClass(order.status)">
            {{ order.status.replace('_', ' ') }}
          </span>
        </div>

        <!-- Progress Bar for Active Orders -->
        <div class="order-progress" *ngIf="selectedTab === 'active' && order.status !== 'CANCELLED'">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="getStatusProgress(order.status)"></div>
          </div>
          <div class="progress-steps">
            <div class="step" [class.completed]="getStatusProgress(order.status) >= 25">
              <div class="step-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M8 1l2 6h6l-5 4 2 6-5-4-5 4 2-6-5-4h6l2-6z" fill="currentColor"/>
                </svg>
              </div>
              <span class="step-label">Placed</span>
            </div>
            <div class="step" [class.completed]="getStatusProgress(order.status) >= 60">
              <div class="step-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M3 3h10v8H3V3z" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M5 7h6M5 9h4" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </div>
              <span class="step-label">Preparing</span>
            </div>
            <div class="step" [class.completed]="getStatusProgress(order.status) >= 80">
              <div class="step-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M2 3h8v7H2V3z" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M10 6h2l2 2v2h-4V6z" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="4" cy="12" r="1" stroke="currentColor" stroke-width="1.5"/>
                  <circle cx="12" cy="12" r="1" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </div>
              <span class="step-label">On the way</span>
            </div>
            <div class="step" [class.completed]="getStatusProgress(order.status) === 100">
              <div class="step-icon">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M5 8l2 2 4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.5"/>
                </svg>
              </div>
              <span class="step-label">Delivered</span>
            </div>
          </div>
          <div class="estimated-time" *ngIf="order.status !== 'DELIVERED'">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
              <circle cx="9" cy="9" r="8" stroke="currentColor" stroke-width="1.5"/>
              <path d="M9 4v5l3 3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            <span>Estimated: {{ getEstimatedTime(order) }}</span>
          </div>
        </div>

        <!-- Delivery Info -->
        <div class="delivery-info" *ngIf="order.delivery && order.status !== 'CANCELLED'">
          <div class="delivery-status">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M2 3h10v9H2V3z" stroke="var(--primary)" stroke-width="1.5"/>
              <path d="M12 7h3l3 3v2h-6V7z" stroke="var(--primary)" stroke-width="1.5"/>
              <circle cx="5" cy="15" r="2" stroke="var(--primary)" stroke-width="1.5"/>
              <circle cx="15" cy="15" r="2" stroke="var(--primary)" stroke-width="1.5"/>
            </svg>
            <div class="delivery-details">
              <p class="delivery-message">{{ getDeliveryStatus(order) }}</p>
              <p class="delivery-driver" *ngIf="order.delivery.assignedDriver">
                <strong>{{ order.delivery.assignedDriver }}</strong> 
                <span class="delivery-status-badge" [ngClass]="'status-' + order.delivery.status.toLowerCase()">
                  {{ order.delivery.status.replace('_', ' ') }}
                </span>
              </p>
            </div>
          </div>
        </div>

        <!-- Order Items -->
        <div class="order-items">
          <div class="item" *ngFor="let item of order.items">
            <span class="item-qty">{{ item.quantity }}x</span>
            <span class="item-name">{{ item.menuItemName || 'Item #' + item.menuItemId }}</span>
            <span class="item-price">₹{{ item.price }}</span>
          </div>
        </div>

        <!-- Order Footer -->
        <div class="order-footer">
          <div class="order-total">
            <span class="total-label">Total Amount</span>
            <span class="total-value">₹{{ order.totalAmount }}</span>
          </div>
          <div class="order-date">
            {{ order.createdAt | date:'medium' }}
          </div>
        </div>

        <!-- Order Actions -->
        <div class="order-actions">
          <button 
            class="btn btn-outline btn-sm" 
            *ngIf="selectedTab === 'active' && order.status === 'PENDING'"
            (click)="cancelOrder(order.id)">
            Cancel Order
          </button>
          <button 
            class="btn btn-outline btn-sm" 
            *ngIf="selectedTab === 'active'"
            (click)="trackOrder(order.id)">
            Track Order
          </button>
          <button 
            class="btn btn-primary btn-sm" 
            *ngIf="selectedTab === 'history' && order.status === 'DELIVERED'"
            (click)="reorder(order)">
            Reorder
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
