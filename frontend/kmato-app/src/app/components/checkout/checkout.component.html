<div class="checkout-page">
  <div class="container">
    <h1 class="page-title">Checkout</h1>

    <!-- Empty Cart State -->
    <div *ngIf="cart.getItems().length === 0" class="empty-state">
      <svg width="100" height="100" viewBox="0 0 100 100" fill="none">
        <circle cx="50" cy="50" r="40" fill="var(--background-light)"/>
        <path d="M30 35h40l-5 25H35l-5-25z" stroke="var(--text-light)" stroke-width="2.5"/>
        <circle cx="40" cy="70" r="2.5" fill="var(--text-light)"/>
        <circle cx="60" cy="70" r="2.5" fill="var(--text-light)"/>
      </svg>
      <h2>Your cart is empty</h2>
      <p>Add items to proceed with checkout</p>
      <button class="btn btn-primary" routerLink="/restaurants">Browse Restaurants</button>
    </div>

    <!-- Checkout Content -->
    <div *ngIf="cart.getItems().length > 0" class="checkout-content">
      <!-- Main Checkout Form -->
      <div class="checkout-form">
        <!-- Delivery Address Section -->
        <div class="checkout-section">
          <div class="section-header">
            <h2 class="section-title">Delivery Address</h2>
            <button class="btn-add-address" (click)="showAddressForm = true" *ngIf="!showAddressForm">
              <svg width="18" height="18" viewBox="0 0 18 18" fill="none">
                <path d="M9 4v10M4 9h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Add New
            </button>
          </div>

          <!-- Loading Addresses -->
          <div *ngIf="loadingAddresses" class="loading-msg">Loading addresses...</div>

          <!-- No Addresses -->
          <div *ngIf="!loadingAddresses && addresses.length === 0 && !showAddressForm" class="info-box">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
              <circle cx="12" cy="12" r="10" stroke="var(--warning)" stroke-width="2"/>
              <path d="M12 8v4M12 16v.5" stroke="var(--warning)" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <p>No delivery address found. Please add one to continue.</p>
          </div>

          <!-- Address List -->
          <div class="address-list" *ngIf="addresses.length > 0 && !showAddressForm">
            <div 
              class="address-card" 
              *ngFor="let address of addresses"
              [class.selected]="selectedAddress === address.id"
              (click)="selectAddress(address.id)">
              <div class="address-radio">
                <input 
                  type="radio" 
                  [id]="'addr-' + address.id" 
                  name="address" 
                  [value]="address.id"
                  [checked]="selectedAddress === address.id"
                  (change)="selectAddress(address.id)">
              </div>
              <div class="address-details">
                <div class="address-type">{{ address.addressType || 'Home' }}</div>
                <div class="address-text">{{ address.street }}, {{ address.city }}, {{ address.state }} {{ address.zipCode }}</div>
              </div>
            </div>
          </div>

          <!-- Add Address Form -->
          <div class="address-form-card" *ngIf="showAddressForm">
            <h3>Add New Address</h3>
            <form (ngSubmit)="saveAddress()">
              <div class="form-row">
                <div class="form-group">
                  <label>Address Type</label>
                  <select [(ngModel)]="newAddress.addressType" name="addressType" required>
                    <option value="HOME">Home</option>
                    <option value="WORK">Work</option>
                    <option value="OTHER">Other</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label>Street Address *</label>
                <input type="text" [(ngModel)]="newAddress.street" name="street" placeholder="Enter street address" required>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>City *</label>
                  <input type="text" [(ngModel)]="newAddress.city" name="city" placeholder="City" required>
                </div>
                <div class="form-group">
                  <label>State *</label>
                  <input type="text" [(ngModel)]="newAddress.state" name="state" placeholder="State" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>Zip Code *</label>
                  <input type="text" [(ngModel)]="newAddress.zipCode" name="zipCode" placeholder="Zip code" required>
                </div>
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary">Save Address</button>
                <button type="button" class="btn btn-secondary" (click)="cancelAddressForm()">Cancel</button>
              </div>
            </form>
          </div>
        </div>

        <!-- Payment Method Section -->
        <div class="checkout-section">
          <h2 class="section-title">Payment Method</h2>
          <div class="payment-methods">
            <div 
              class="payment-card"
              [class.selected]="paymentMethod === 'CARD'"
              (click)="paymentMethod = 'CARD'">
              <div class="payment-radio">
                <input type="radio" id="card" name="payment" value="CARD" [(ngModel)]="paymentMethod">
              </div>
              <div class="payment-info">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                  <rect x="4" y="8" width="24" height="16" rx="2" stroke="currentColor" stroke-width="2"/>
                  <path d="M4 12h24" stroke="currentColor" stroke-width="2"/>
                  <path d="M8 18h6M18 18h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <div>
                  <div class="payment-name">Credit/Debit Card</div>
                  <div class="payment-desc">Pay securely with your card</div>
                </div>
              </div>
            </div>

            <div 
              class="payment-card"
              [class.selected]="paymentMethod === 'CASH'"
              (click)="paymentMethod = 'CASH'">
              <div class="payment-radio">
                <input type="radio" id="cash" name="payment" value="CASH" [(ngModel)]="paymentMethod">
              </div>
              <div class="payment-info">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none">
                  <circle cx="16" cy="16" r="12" stroke="currentColor" stroke-width="2"/>
                  <path d="M16 10v12M12 14h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <div>
                  <div class="payment-name">Cash on Delivery</div>
                  <div class="payment-desc">Pay when you receive</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Special Instructions -->
        <div class="checkout-section">
          <h2 class="section-title">Special Instructions (Optional)</h2>
          <textarea 
            class="instructions-input"
            [(ngModel)]="specialInstructions"
            name="instructions"
            placeholder="Add delivery instructions, preferences, etc."
            rows="3"></textarea>
        </div>
      </div>

      <!-- Order Summary Sidebar -->
      <div class="order-summary-sidebar">
        <div class="order-summary-card">
          <h3 class="summary-title">Order Summary</h3>
          
          <!-- Order Items -->
          <div class="summary-items">
            <div class="summary-item" *ngFor="let item of cart.getItems()">
              <span class="item-qty">{{ item.quantity }}x</span>
              <span class="item-name">{{ item.name }}</span>
              <span class="item-price">₹{{ item.price * item.quantity }}</span>
            </div>
          </div>

          <div class="summary-divider"></div>

          <!-- Price Breakdown -->
          <div class="summary-row">
            <span class="label">Subtotal</span>
            <span class="value">₹{{ subtotal }}</span>
          </div>
          <div class="summary-row">
            <span class="label">Delivery Fee</span>
            <span class="value">₹{{ deliveryFee }}</span>
          </div>
          <div class="summary-row">
            <span class="label">Platform Fee</span>
            <span class="value">₹{{ platformFee }}</span>
          </div>
          <div class="summary-row">
            <span class="label">GST (5%)</span>
            <span class="value">₹{{ tax.toFixed(2) }}</span>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-row summary-total">
            <span class="label">Total</span>
            <span class="value">₹{{ totalAmount.toFixed(2) }}</span>
          </div>

          <!-- Place Order Button -->
          <button 
            class="btn btn-primary btn-place-order" 
            (click)="placeOrder()"
            [disabled]="!selectedAddress || placingOrder">
            <span *ngIf="!placingOrder">Place Order</span>
            <span *ngIf="placingOrder">
              <div class="spinner-small"></div>
              Processing...
            </span>
          </button>

          <p class="terms-text">
            By placing order, you agree to our <a href="#">Terms & Conditions</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
